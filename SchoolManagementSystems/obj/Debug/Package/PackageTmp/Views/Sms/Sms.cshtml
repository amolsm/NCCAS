@model Entity.smsviewmodel
@{
    ViewBag.Title = "Sms Master";
    Layout = "~/Views/shared/_SharedLayout.cshtml";
}
<script type="text/javascript">
    $(document).ready(function () {
        FillType();
        $("#From").empty();
        function FillType() {
            var item = '<option value="">select Role</option>';
            item += '<option value="1">Student & Parent</option>';
            item += '<option value="5">Employee</option>';
            $("#Roleid").append(item);
        }

        function checkChecked() {
            var anyBoxesChecked = "";
            $('#frm input[type="checkbox"]').each(function () {
                if ($(this).is(":checked")) {
                    anyBoxesChecked += this.id + ",";
                }
            });
            var msg = $("#msg").val();
            $.ajax({
                type: 'GET',
                url: '@Url.Action("SendSms")',
                dataType: 'JSON',
                data: { nos: anyBoxesChecked, msg: msg },
                success: function () {
                    alert("Message sent successfully!..");
                    window.location.replace("Sms");
                }
            });
        }

        $("#insert").click(function () {
            if (valid()) {
                checkChecked();
            }
        });

        $("#insert").hide();

        $("#Roleid").change(function () {
            $("#From").empty();
            if ($("#Roleid").val() == 1) {
                $("#Classid").val('');
                $(".studclass").show();
                $("#insert").hide();
            }
            else {
                $(".studclass").hide();
                $("#insert").show();
                $.ajax({
                    type: 'GET',
                    url: '@Url.Action("GetEmployee")',
                    dataType: 'JSON',
                    data: {},
                    success: function (data) {

                        if (data != null) {

                            var item = '<tr><th></th><th>Employee id</th><th>Employee Name</th><th>Contact No.</th></tr>';
                            $.each(data, function (i, d) {

                                item += '<tr>'
                                item += '<td><input class="move" type="checkbox"  id="' + d.Empid + '"> </input></td>';
                                item += '<td>' + d.Empid + '</td>';
                                item += '<td>' + d.fullname + '</td>';
                                item += '<td>' + d.MobileNo + '</td></tr>';

                            });
                            $("#From").append(item);

                            return false;
                        }
                        else {
                            var item = '<span value="0">No record found!!!</span>';
                            $("#From").append(item);
                        }
                    }
                });
            }
        });

        function valid() {
            var i = 0;
            var anyBoxesChecked = "";
            $('#frm input[type="checkbox"]').each(function () {
                if ($(this).is(":checked")) {
                    anyBoxesChecked += this.id + ",";
                }
            });
            if (anyBoxesChecked == "") {
                i = i+1;
                alert("Please select any checkbox!.");
                //return false;
            }



            if ($('#msg').val() == "") {
                i = i+1;
                alert("Please enter any message!.");
                //return false;
            }

            if (i > 0) {
                return false;
            }
            else {
                return true;
            }


        }
        $('#Classid').change(function () {
            $("#From").empty();
            var Classid = $("#Classid").val();
            $.ajax({
                type: 'GET',
                url: '@Url.Action("ClassStudent")',
                dataType: 'JSON',
                data: { Class: Classid },
                success: function (data) {

                    if (data != null) {

                        var item = '<tr><th></th><th>Student id</th><th>Student Name</th><th>Father\'s Name</th><th>Contact No.</th></tr>';
                        $.each(data, function (i, d) {

                            item += '<tr>'
                            item += '<td><input class="move" type="checkbox"  id="' + d.FatherContact + '"> </input></td>';
                            item += '<td>' + d.Studid + '</td>';
                            item += '<td>' + d.Studnm + '</td>';
                            item += '<td>' + d.Studfathernm + '</td>';
                            item += '<td>' + d.FatherContact + '</td></tr>';

                        });
                        $("#From").append(item);
                        $("#insert").show();
                        return false;
                    }
                    else {
                        $("#insert").hide();
                        var item = '<span value="0">No record found!!!</span>';
                        $("#From").append(item);
                    }
                }
            });
        });
    });
</script>
@Html.Partial("_PermissionHiddenFlds")
<div class="container">
    <div class="row">
        <table cellpadding="0" cellspacing="0" style="margin-top: 38px;margin-bottom: 90px;">
            <tr>
                <td class="col-md-9" style="padding-top: 38px;">
                    <ul class="breadcrumb">
                        <li>@Html.ActionLink("Home", "Login", "Login")</li>
                        <li>@Html.ActionLink("Sms Management", "Sms", "Sms", "")</li>
                        <li class="active">Sms Management</li>
                    </ul>
                    <div class="col-md-10" style="width: 100%;">
                        <center>
                            <table width="100%">
                                <tr>
                                    <td>
                                        <div id="AddForm" style="display: block;">
                                            @using (Html.BeginForm("", "", FormMethod.Post, new { id = "frm", @class = "form-inline" }))
                                            {
                                                @Html.ValidationSummary(true)
                                                <div id="lblmsg" class="form-group col-md-9">
                                                </div>
                                                <div class="form-group col-md-6">
                                                    @Html.LabelFor(model => model.Roleid, new { @class = "col-md-6 form_out" })
                                                    <select id="Roleid" class="col-md-5 form-control form_in" name="Type">
                                                    </select>
                                                    @Html.ValidationMessageFor(model => model.Roleid)
                                                </div>
                                                <div class="studclass" style="display: none;">
                                                    <div class="form-group col-md-6" style="text-align: center;">
                                                        @Html.LabelFor(model => model.Classid, new { @class = "col-md-6 form_out", @style = "text-align: left;" })
                                                        @Html.ValidationMessageFor(model => model.Classid)
                                                        @Html.DropDownListFor(model => model.Classid, new SelectList(Model._Classlist, "Classid", "Classnm", "Select Class"), "Select Class", new { @class = "col-md-5 form-control form_in drop t" })
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-9" style="text-align: center;">
                                                    @Html.Label("Message", new { @style = "text-align:left;", @class = "col-md-4 form_out t" })
                                                    @Html.TextAreaFor(m => m.msg, new { @class = "col-md-9 form-control form_in drop t", @maxlength = 140, @cols="50", @rows = "4", @style="padding-right:10px;" })
                                                </div>
                                                <div class="form-group col-md-12" style="margin: 10px 0px 0px 0px;">
                                                    <div id="result" class="table-responsive" style="width: 48%; float: left;">
                                                        <table id="From" class="table tb-parshav">
                                                            <tr>
                                                                <td>
                                                                    &nbsp;
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-9">
                                                </div>
                                                <div class="form-group col-md-9" style="margin: 10px; text-align: center;">
                                                    <input type="button" class="btn btn-primary" id="insert" value="Send" />                                                    
                                                </div>
                                            }
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <br />
                                    </td>
                                </tr>
                                <tr>
                                    <td valign="top">
                                        <div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </center>
                    </div>
                </td>
            </tr>
        </table>
    </div>
</div>
