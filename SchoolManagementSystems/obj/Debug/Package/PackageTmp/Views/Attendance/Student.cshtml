@model Entity.Attendanceviewmodel
@{
    ViewBag.Title = "Student";
    Layout = "~/Views/shared/_SharedLayout.cshtml";
}
@*<script src="../../Scripts/jquery-1.10.2.js" type="text/javascript"></script>*@
<script src="../../Scripts/jquery-ui.js" type="text/javascript"></script>
<style type="text/css">
    .ui-datepicker-calendar
    {
        background-color: antiquewhite;
    }
    
    .ui-datepicker-title
    {
        background-color: antiquewhite;
    }
    
    .ui-icon ui-icon-circle-triangle-w
    {
        background-color: antiquewhite;
    }
    #ui-datepicker-div
    {
        display: none;
    }
</style>
<script type="text/javascript">

    $(document).ready(function () {
        FillPermission();
        $("#tblStudent").on("click", ".feePay", function (evt) {
            var Studid = this.id;
            var reason = $("#Reason_" + Studid).val();
            var absent = $("#Absent_" + Studid);
            var AbsentDate = ($("#datepicker").val());
            var remark = "";
            if ($("#Absent_" + Studid).is(":checked") && reason != "") {
                remark = "true";
            }
            else {
                alert("Please select absent and provide a reason!!");
                return false;
            }
            $.ajax({
                type: 'POST',
                url: '@Url.Action("StudentAtt")',
                dataType: 'json',
                data: { id: Studid, r: reason, date: AbsentDate, Absent: remark },
                success: function (students) {
                    if (students != "") {
                        
                    }
                },
                error: function (ex) {
                    alert('Failed to retrieve data.' + ex);
                }
            });
        });

        $("#insert").click(function (e) {
            Validations(e);
        });

        $('#datepicker').attr("readonly", true);

        $('#datepicker').datepicker({
            inline: true,
            showOtherMonths: true,
            showOtherYears: true,
            dayNamesMin: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
            dateFormat: 'mm/dd/yy',
            changeMonth: true,
            yearRange: "-100:+0",
            changeYear: true
        });

        $('#datepicker').datepicker('setDate', new Date());

        $('#StaffAbsent').change(function () {
            if ($(this).is(":checked")) {
                $('#staffreason').css('display', 'block');
            }
            else {
                $('#staffreason').css('display', 'none');
            }
        });



        function Validations(e) {
            var cnt = 0;
            if ($("#Empid").val() == '') {
                cnt++;
                $("#Empid").css({
                    "border": "1px solid red"
                });
            }
            else {
                $("#Empid").css({
                    "border": "",
                    "background": ""
                });
            }

            if ($("#AttendanceDate").val() == '') {
                cnt++;
                $("#AttendanceDate").css({
                    "border": "1px solid red"
                });
            }
            else {
                $("#AttendanceDate").css({
                    "border": "",
                    "background": ""
                });
            }

            if (cnt != 0) {
                e.preventDefault();
            }
        }

        $('#srch').click(function () {
            var Classid = $('#Classid').val();
            var Search_Data = $('#Search_Data').val();
            if (Search_Data != "") {
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("GetStudentsSearchData")',
                    dataType: 'json',
                    data: { id: Classid, Search_Data: Search_Data },
                    success: function (students) {
                        if (students != "") {
                            $('#tblStudent').html('');
                            var hrow = "<thead><tr><th>Student ID</th><th>Student Name</th><th>Student Roll No</th><th>Absent</th><th>Reason</th><th>Action</th></tr></thead><tbody>";
                            $('#tblStudent').append(hrow);
                            $.each(students, function (i, item) {
                                var rows = "<tr>"
                                + "<td >" + item.Studid + "</td>"
                                + "<td >" + item.Studnm + "</td>"
                                + "<td > " + item.RollNo + " </td>"
                                + "<td> <input type='checkbox' id='Absent_" + item.Studid + "' class='approve' /> </td>"
                                + "<td> <input type='text' id='Reason_" + item.Studid + "' style='width:100%' class='Reason' /> </td>"
                                + "<td ><input type='button' id='" + item.Studid + "' class='feePay btn btn-default btn_edit' value='Absent' /></td>"
                                + "</tr>";
                                $('#tblStudent').append(rows);
                            });
                            $('#tblStudent').append("</tbody>");
                            ReloadPaging();
                        }
                        else {
                            $('#tblStudent').html('');
                        }
                    },
                    error: function (ex) {
                        alert('Failed to retrieve students.' + ex);
                    }
                });
            }
            else {
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("GetStudents")',
                    dataType: 'json',
                    data: { id: $("#Classid").val() },
                    success: function (students) {
                        if (students != "") {
                            $('#tblStudent').html('');
                            var hrow = "<thead><tr><th>Student ID</th><th>Student Name</th><th>Student Roll No</th><th>Absent</th><th>Reason</th><th>Action</th></tr></thead><tbody>";
                            $('#tblStudent').append(hrow);
                            $.each(students, function (i, item) {
                                var rows = "<tr>"
                                + "<td >" + item.Studid + "</td>"
                                + "<td >" + item.Studnm + "</td>"
                                + "<td > " + item.RollNo + " </td>"
                                + "<td> <input type='checkbox' id='Absent_" + item.Studid + "' class='approve' /> </td>"
                                + "<td> <input type='text' id='Reason_" + item.Studid + "' style='width:100%' class='Reason' /> </td>"
                                + "<td ><input type='button' id='" + item.Studid + "' class='feePay btn btn-default btn_edit' value='Absent' /></td>"
                                + "</tr>";
                                $('#tblStudent').append(rows);
                            });
                            $('#tblStudent').append("</tbody>");
                            ReloadPaging();
                        }
                        else {
                            $('#tblStudent').html('');
                        }
                    },
                    error: function (ex) {
                        alert('Failed to retrieve students.' + ex);
                    }
                });
            }
        });

        $('#Classid').change(function () {
            var Classid = $('#Classid').val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetStudents")',
                dataType: 'json',
                data: { id: $("#Classid").val() },
                success: function (students) {
                    if (students != "") {
                        $('#tblStudent').html('');
                        var hrow = "<thead><tr><th>Student ID</th><th>Student Name</th><th>Student Roll No</th><th>Absent</th><th>Reason</th><th>Action</th></tr></thead><tbody>";
                        $('#tblStudent').append(hrow);
                        $.each(students, function (i, item) {
                            var rows = "<tr>"
                                + "<td >" + item.Studid + "</td>"
                                + "<td >" + item.Studnm + "</td>"
                                + "<td > " + item.RollNo + " </td>"
                                + "<td> <input type='checkbox' id='Absent_" + item.Studid + "' class='approve' /> </td>"
                                + "<td> <input type='text' id='Reason_" + item.Studid + "' style='width:100%' class='Reason' /> </td>"
                                + "<td ><input type='button' id='" + item.Studid + "' class='feePay btn btn-default btn_edit' value='Absent' /></td>"
                                + "</tr>";
                            $('#tblStudent').append(rows);
                        });
                        $('#tblStudent').append("</tbody>");
                        ReloadPaging();
                        $('#srch_criteria').show();
                    }
                    else {
                        $('#tblStudent').html('');
                    }
                },
                error: function (ex) {
                    alert('Failed to retrieve students.' + ex);
                }
            });
        });
        ReloadPaging();
    });
</script>
@Html.Partial("_PermissionHiddenFlds")
<div class="container">
    <div class="row">
        <table cellpadding="0" cellspacing="0" style="margin-top: 38px; margin-bottom:72px;">
            <tr>
                <td class="col-md-2 well blbg" style="margin-top: 50px; margin-bottom:90px;" valign="top">
                    @* <div class="well blbg">
                        <a href="~/Login/Login">Back to Home</a>*@
                    @Html.Partial("_AttendanceMenuList")
                    @*</div>*@
                </td>
                <td class="col-md-9" style="padding-top: 30px; margin-bottom:90px;">
                    <ul class="breadcrumb">
                        <li>@Html.ActionLink("Home", "Login", "Login")</li>
                        <li>@Html.ActionLink("Attendance Management", "Index", "Attendance", "")</li>
                        <li class="active">Student Attendances</li>
                        <div id="srch_criteria" style="float: right;display:none;">
                            @*@using (Html.BeginForm())
                            {*@
                            @Html.TextBox("Search_Data", ViewBag.FilterValue as string)
                            <input type="submit" id="srch" value="Find" />
                            @*}*@
                        </div>
                    </ul>
                    <div class="col-md-10" style="width: 100%; text-align: left;">
                        <center>
                            <!-- table start -->
                            <table width=" 100%">
                                <tr>
                                    <td>
                                        <div>
                                        <div id="AddForm" style="display: none;">
                                            @using (Html.BeginForm("ClassStudentAttendance", "Attendance", FormMethod.Post, new { enctype = "multipart/form-data", id = "frm", @class = "form-inline" }))
                                            {
                                                @Html.ValidationSummary(true)
                                                <div class="form-group col-md-9">
                                                    <h2 style="color:red;">
                                                        @TempData["ErrorMessage"]
                                                    </h2>
                                                </div>
                                                <div class="form-group col-md-9">
                                                    @Html.LabelFor(model => model.Classid, new { @class = "col-md-6 form_out" })
                                                    @Html.DropDownListFor(model => model.Classid, new SelectList(Model.Classlist, "Classid", "Classnm", "Select Class"), "Select Class", new { @class = "col-md-5 form-control form_in" })
                                                    @Html.ValidationMessageFor(model => model.Classid)
                                                </div>
                                                <div class="form-group col-md-9">
                                                    @Html.LabelFor(model => model.AttendanceDate, new { @class = "col-md-6 form_out" })
                                                    @Html.TextBoxFor(model => model.AttendanceDate, new { id = "datepicker", placeholder = "Select Date of Attendance", @class = "col-md-5 form-control form_in" })
                                                    @Html.ValidationMessageFor(model => model.AttendanceDate)
                                                </div>
                                                <div class="form-group col-md-9" id="staffreason" style="display: none;">
                                                </div>
                                                <div class="form-group col-md-9" style="text-align: center;">
                                                    <input type="submit" class="btn btn-primary" action="insert" id="insert" value="Submit" />
                                                </div>
                                                
                                                <div id="result" class="table-responsive" style="margin-top:20px;">
                                                    <div class="" style="margin-left: -30px;">
                                                        <table id="tblStudent" class="table tb-parshav tablesorter">
                                                            <tr>
                                                                <td>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                                <div id="pager" class="col-md-4 col-md-offset-8" style="position: none;">
                                                    <img src="../../Content/images/first.png" style="width: 19px;" class="first" />
                                                    <img src="../../Content/images/prev.png" style="width: 19px;" class="prev" />
                                                    <input type="text" style="width: 50px;" disabled="disabled" class="pagedisplay" />
                                                    <img src="../../Content/images/next.png" style="width: 19px;" class="next" />
                                                    <img src="../../Content/images/last.png" style="width: 19px;" class="last" />
                                                    <select style="border-color: Blue;" class="pagesize">
                                                        <option selected="selected" value="10">10</option>
                                                        <option value="15">15</option>
                                                        <option value="20">20</option>
                                                        <option value="25">25</option>
                                                        <option value="50">50</option>
                                                        <option value="100">100</option>
                                                    </select>
                                                </div>
                                                

                                            }
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </center>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <!-- table end -->
</div>
