@model Entity.Attendanceviewmodel
@{
    ViewBag.Title = "Staff";
    Layout = "~/Views/shared/_SharedLayout.cshtml";
}
@*<script src="../../Scripts/jquery-1.10.2.js" type="text/javascript"></script>*@
<script src="../../Scripts/jquery-ui.js" type="text/javascript"></script>
<style type="text/css">
    .ui-datepicker-calendar
    {
        background-color: antiquewhite;
    }
    
    .ui-datepicker-title
    {
        background-color: antiquewhite;
    }
    
    .ui-icon ui-icon-circle-triangle-w
    {
        background-color: antiquewhite;
    }
    
    #ui-datepicker-div
    {
        display: none;
    }

    .hide
    {
        display:none;
    }
    .show
    {
        display:block;
    }
</style>
<script type="text/javascript">
    $('#Classid').change(function () {
        var Classid = $('#Classid').val();
        $.ajax({
            type: 'POST',
            url: '@Url.Action("GetStudents")',
            dataType: 'json',
            data: { id: $("#Classid").val() },
            success: function (students) {
                if (students != "") {
                    var item = '<option value="">Select Student</option>';
                    $.each(students, function (i, student) {
                        item += '<option value="' + student.Value + '">' + student.Text + '</option>';
                    });
                    $("#Studid").append(item);
                    $("#Studid").val(data.Studid);
                }
                else {
                    var item = '<option value="">Select Student</option>';
                    $("#Studid").append(item);
                }
            },
            error: function (ex) {
                alert('Failed to retrieve students.' + ex);
            }
        });
    });

    $(document).ready(function () {
        FillPermission();
        $("#insert").click(function (e) {
            Validations(e);
        });

        $('#datepicker').attr("readonly", true);

        $('#datepicker').datepicker({
            inline: true,
            showOtherMonths: true,
            showOtherYears: true,
            dayNamesMin: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
            dateFormat: 'dd/mm/yy',
            changeMonth: true,
            yearRange: "-100:+0",
            changeYear: true
        });

        $(".Absent").click(function (e) {
            clearmsg();
            debugger;
            var empid = this.id;
            var reason = $("#Reason_" + empid).val();
            var absent = $("#Absent_" + empid);
            var AbsentDate = ($("#datepicker").val());
            var LeaveTypeName = $("#LeaveTypeid_" + empid).val();
            var remark = "";
            if ($("#Absent_" + empid).prop('checked', false) && reason != "" && LeaveTypeName != "") {
                remark = "true";
            }
            else
            {
                alert("Please select absent, Leave Type and provide a reason!!");
                return false;
            }
            $.ajax({
                type: 'POST',
                url: '@Url.Action("AbsentEmployee")',
                dataType: 'json',
                data: { id: empid, r: reason, date: AbsentDate, Absent: remark, LeaveType: LeaveTypeName },
                success: function (students) {
                    if (students != "") {
                        $("#msgs").show();
                        $("#lblmsgs").text("Staff attendance updated successfully!..");
                        $("#lblmsgs").css({ "color": "green" });
                        $("#lblmsgs").css({ "font-size": "15px" });
                        $("#result").html(result);
                        clear();
                        ReloadPaging();
                    }
                },
                error: function (ex) {
                    alert('Failed to retrieve data.' + ex);
                }
            });
        })
        function clearmsg() {
            $("#msg").hide();
            $("#msgs").hide();
        }
        $(".approve").change(function (e) {

            var empid = this.id.replace("Absent_", "");

            var absent = $("#Absent_" + empid);
            var AbsentDate = ($("#datepicker").val());
            var remark = "";
            if ($("#Absent_" + empid).is(":checked")) {
                $("#LeaveTypeid_" + empid).removeClass("show");
                $("#LeaveTypeid_" + empid).addClass("hide");

                return false;
            }
            else {
                $("#LeaveTypeid_" + empid).removeClass("hide");
                $("#LeaveTypeid_" + empid).addClass("show");
            }
        });

        $('#datepicker').datepicker('setDate', new Date());

        $('#StaffAbsent').change(function () {
            if ($(this).is(":checked")) {
                $('#staffreason').css('display', 'block');
            }
            else {
                $('#staffreason').css('display', 'none');
            }
        });   
        $('.approve').prop('checked', true);
        
        function Validations(e) {
            var cnt = 0;
            if ($("#Empid").val() == '') {
                cnt++;
                $("#Empid").css({
                    "border": "1px solid red"
                });
            }
            else {
                $("#Empid").css({
                    "border": "",
                    "background": ""
                });
            }

            if ($("#AttendanceDate").val() == '') {
                cnt++;
                $("#AttendanceDate").css({
                    "border": "1px solid red"
                });
            }
            else {
                $("#AttendanceDate").css({
                    "border": "",
                    "background": ""
                });
            }

            if (cnt != 0) {
                e.preventDefault();
            }
        }
        ReloadPaging();
       
       @* $("#insert").click(function () {
            debugger;
            var presentdetails = []; 
            var n = $("table").find("tr").each(function (evt) {

            //for (var i = 1; i < n; i++) {
                var StaffId = ($(this).val());
                var AttendanceDate = ($("#datepicker").val());
                var InTime = ($("#datepicker").val());
                var OutTime = ($("#datepicker").val());
                var absent = $("#Absent").val();
                var reason = $("#Reason_" + empid).val();
                var Empid = ($(this).val());
                var LeaveStartDate = ($("#datepicker").val());
                var LeaveEndDate = ($("#datepicker").val());
                var LeaveTypeName = $("#LeaveTypeid_" + Empid).val();
                var Description = $("#Reason_" + Empid).val();
                var IsApprove = $("#Absent_" + Empid);

                var remark = "";
                //if ($("#Absent_" + empid).is(":checked") && reason != "" && LeaveTypeName != "") {
                //    remark = "true";
                //}
                //else
                //{
                //    alert("Please select absent, Leave Type and provide a reason!!");
                //    return false;
                //}
            });
            if (presentdetails != "") {
                var options = {};
                options.type = "POST",
                options.url = '@Url.Action("DMLAttendancestaff")',
                    options.data = JSON.stringify(presentdetails);
                    options.contentType = "application/json";
                    options.success = function (presentdetails) {
                        $("#msgs").show();
                        $("#lblmsgs").text("PresentList  updated successfully!..");
                        $("#lblmsgs").css({ "color": "green" });
                        $("#lblmsgs").css({ "font-size": "15px" });
                        $("#result").html(result);
                        clear();

                        ReloadPaging();
                        //alert("PresentList updated successfully!..");
                    };
                    options.error = function (presentdetails) {
                        $("#msg").show();
                        $("#lblmsg").text("Error while save the records!..");
                        $("#lblmsg").css({ "color": "orange" });
                        $("#lblmsg").css({ "font-size": "15px" });
                        $("#result").html(result);
                        clear();

                        ReloadPaging();
                        //alert("Error while save the records!");
                    };
                    $.ajax(options);
                }
              //}
              //else {
              //    alert("Something wrong");
              //}
          });*@
    });
</script>
@Html.Partial("_PermissionHiddenFlds")
<div class="container-fluid-full">
             
		<div class="row-fluid">
           @Html.Partial("_AttendanceMenuList")
	<div id="content" class="span10">
        	<div class="row-fluid">
           
                    <ul class="breadcrumb">
                    <li><i class="icon-home"></i>@Html.ActionLink("Home", "Login", "Login")<i class="icon-angle-right"></i>
                        @Html.ActionLink("Employee Managementt", "Index", "Attendance", "")<i class="icon-angle-right"></i></li>
                        <li class="active">Staff Attendances</li>
                        <div id="srch_criteria" style="float: right; display: block;">
                            @using (Html.BeginForm())
                            {
                                @Html.TextBox("Search_Data", ViewBag.FilterValue as string)
                                <input type="submit" id="srch" value="Find" />
                            }
                        </div>
                    </ul>
                <div class="panel-body"> 
                   <div id="msg" hidden="hidden" class="alert alert-warning" visible="false">
	                <strong><label id="lblmsg"></label></strong> 
	                 </div>
                <div id="msgs" hidden="hidden" class="alert alert-success" visible="false">
	            <strong><label id="lblmsgs"></label></strong> 
                </div>
                  </div>
                    <div class="row-fluid sortable">
              <div class="box span12">
					<div class="box-header" data-original-title>
						<h2><i class="fa fa-edit"></i><span class="break"></span>Form Elements</h2>
						<div class="box-icon">
						
							<a href="#" class="btn-minimize"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
						
						</div>
					</div>
                               		<div class="box-content span11">
                      <div class="box-content span12">
                                               
						<form id="frm" class="form-horizontal">
                              
						
                                  <fieldset>
                                            @using (Html.BeginForm("StaffAttendance", "Attendance", FormMethod.Post, new { enctype = "multipart/form-data", id = "frm", @class = "form-horizontal" }))
                                            {
                                                @Html.ValidationSummary(true)
                                                <div class="control-group">
                                                    <h2 style="color:red;">
                                                        @TempData["ErrorMessage"]
                                                    </h2>
                                                </div>
                                                <div class="control-group">
                                                    @Html.LabelFor(model => model.AttendanceDate, new {  @class="control-label"})
                                                     <div class="controls">
                                                    @Html.TextBoxFor(model => model.AttendanceDate, new { id = "datepicker", placeholder = "Select Date of Attendance"})
                                                    @Html.ValidationMessageFor(model => model.AttendanceDate)
                                                </div>
                                                    </div>

                                                @*<div id="result" class="table-responsive">
                                                    <div class="" style="margin-left: -30px;">
                                                        <table id="tblStudent" class="table tb-parshav tablesorter">
                                                            <tr>
                                                                <td>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>*@
                                                

                                                <div id="chk" class="table-responsive">
                                                    <table id="result" class="table table-striped table-bordered bootstrap-datatable datatable">
                                                        <thead>
                                                            <tr>
                                                                <th>
                                                                    @Html.DisplayName("Employee ID")
                                                                </th>
                                                                <th>
                                                                    @Html.DisplayName("Employee")
                                                                </th>
                                                                <th>
                                                                     @*<input type="checkbox" id='check' class="check" style="float:left;" />*@
                                                                    @Html.DisplayName("Present")
                                                                </th>
                                                                <th>
                                                                    @Html.DisplayName("Reason")
                                                                </th>
                                                                <th>
                                                                    @Html.DisplayName("Action")
                                                                </th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @foreach (var item in Model.Employeelist)
                                                            {
                                                                <tr>
                                                                    <td width="10%">
                                                                        @Html.DisplayFor(modelItem => item.Empid)
                                                                    </td>
                                                                    <td width="20%">
                                                                        @Html.DisplayFor(modelItem => item.FirstName)
                                                                    </td>
                                                                    <td width="17%">
                                                                        <input type="checkbox" id='Absent_@item.Empid' class="approve" style="float:left;" />
                                                                        @Html.DropDownListFor(model => model.LeaveTypeid, new SelectList(Model.Leavelist, "leaveid", "leavename", "Select leave"), "Select leave", new { @id="LeaveTypeid_"+item.Empid,  @class = "col-md-3 form-control hide", @style="float:left; margin-left:10px;" })
                                                                    </td>
                                                                    <td>
                                                                        <input type="text" id='Reason_@item.Empid' class="Reason" style="width:97%"/>
                                                                    </td>
                                                                    <td  width="10%">
                                                                        <input type="button" id="@item.Empid" class="btn btn-default Absent" value="Absent" />
                                                                    </td>
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                             
                                               <div class="form-actions span12" style="padding-left:40%">
                                                    <input type="submit" action="insert" class="btn btn-primary" id="insert" value="Present All" />
                                                </div>
                                            }
                                             </fieldset>
                                </form>
					
					</div>
                                           </div>
				</div><!--/span-->
			
			</div><!--/row-->
                </div>
        </div>
            </div>
    </div>
