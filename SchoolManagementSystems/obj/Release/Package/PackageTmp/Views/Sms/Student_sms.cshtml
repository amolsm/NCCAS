@model Entity.smsviewmodel

@{
    ViewBag.Title = "Student_sms";
    Layout = "~/Views/shared/_SharedLayout.cshtml";
}

<script type="text/javascript">
    $(document).ready(function () {
      
        $("#From").empty();
    

        function checkChecked() {
            var anyBoxesChecked = "";
            $('#result input[type="checkbox"]').each(function () {
                if ($(this).is(":checked")) {
                    anyBoxesChecked += this.id + ",";
                }
            });
            var msg = $("#msg").val();
            $.ajax({
                type: 'GET',
                url: '@Url.Action("SendSms")',
                dataType: 'JSON',
                data: { nos: anyBoxesChecked, msg: msg },
                success: function () {
                    alert("Message sent successfully!..");
                    window.location.replace("Sms");
                }
            });
        }

        $("#insert").click(function () {
            if (valid()) {
                checkChecked();
            }
        });

        //$("#insert").hide();

        $("#header").click(function () {
            if ($("#Add_header").is(":checked")) {
                $(".addcls").prop('checked', true);
            }
            else {
                $(".addcls").prop('checked', false);
            }

        });

        $("#DivisionId").change(function () {
            $("#result").empty();
            var Classid = $('#Classid').val();
            var Divisionid = $('#DivisionId').val();
            if (Divisionid != 0) {
               
                $.ajax({
                    type: 'GET',
                    url: '@Url.Action("ClassStudentDivision")',
                    dataType: 'JSON',
                    data: { Classid: Classid, Divisionid: Divisionid },
                    success: function (data) {

                        if (data != null) {
                          
                            var result = $('#result');
                            var head = $('#header');
                            var table; var header
                            var StudentIds;
                            result.html('');
                            $("#students").val(data.length);
                            header = "<table  class='table tb-parshav tablesorter'><thead><tr><th width='100px;'><input type='checkbox' id='Add_header' /></th><th width='100px;'>Student ID</th><th  width='200px;'>Student Name</th><th width='100px;'>Father\'s Name</th><th width='100px;'>Contact No.</th></thead></table>";
                            head.html(header);
                            table = "<table class='table tb-parshav tablesorter'><tbody>";
                            for (var i = 0; i < data.length; i++) {
                                StudentIds = data[i].Studid;
                                table += "<tr id=" + StudentIds + "><td width='100px;'><input class='addcls' type='checkbox' onchange='valueChanged()'  id='" + data[i].FatherContact.toString() + "'  value='" + data[i].FatherContact.toString() + "'></td><td width='100px;'>" + data[i].Studid.toString() + "</td><td  width='200px;'>" + data[i].Studnm.toString() + "</td><td width='100px;'>" + data[i].Studfathernm.toString() + "</td><td width='100px;'>" + data[i].FatherContact.toString() + "</td></tr>";
                            }
                            table += "</tbody><table>";
                            result.html(table);
                            myFunction();

                        }

                    }
                });
            }
        });
      
        function myFunction() {
            var StudentIds = $("#students").val(data.length)
            ;
        }
        function clearBox(elementID) {
            document.getElementById(elementID).innerHTML = "";
        }
        function valid() {
            var i = 0;
            var anyBoxesChecked = "";
            $('#result input[type="checkbox"]').each(function () {
                if ($(this).is(":checked")) {
                    anyBoxesChecked += this.id + ",";
                }
            });
            if (anyBoxesChecked == "") {
                i = i+1;
                alert("Please select any checkbox!.");
                //return false;
            }



            if ($('#msg').val() == "") {
                i = i+1;
                alert("Please enter any message!.");
                //return false;
            }

            if (i > 0) {
                return false;
            }
            else {
                return true;
            }


        }
             $('#Classid').change(function () {
                 $("#result").empty();
                 $("#DivisionId").empty();
                 var Classid = $("#Classid").val();
                 $.ajax({
                     type: 'GET',
                     url: '@Url.Action("ClassStudent")',
                dataType: 'JSON',
                data: { Class: Classid },
                success: function (data) {

                    if (data != null) {
                       
                        var result = $('#result');
                        var head = $('#header');
                        var table; var header
                        var StudentIds;
                        result.html('');
                        $("#students").val(data.length);
                        header = "<table  class='table tb-parshav tablesorter'><thead><tr><th width='100px;'><input type='checkbox' id='Add_header' /></th><th width='100px;'>Student ID</th><th  width='200px;'>Student Name</th><th width='100px;'>Father\'s Name</th><th  width='100px;'>Contact No.</th></thead></table>";
                        head.html(header);
                        table = "<table class='table tb-parshav tablesorter'><tbody>";
                        for (var i = 0; i < data.length; i++) {
                            StudentIds = data[i].Studid;
                            table += "<tr id=" + StudentIds + "><td width='100px;'><input class='addcls' type='checkbox' onchange='valueChanged()'  id='" + data[i].FatherContact.toString() + "'  value='" + data[i].FatherContact.toString() + "'></td><td width='100px;'>" + data[i].Studid.toString() + "</td><td  width='200px;'>" + data[i].Studnm.toString() + "</td><td width='100px;'>" + data[i].Studfathernm.toString() + "</td><td width='100px;'>" + data[i].FatherContact.toString() + "</td></tr>";
                        }
                        table += "</tbody><table>";
                        result.html(table);
                        myFunction();

                    }

                }
                    });
            $.ajax({
                type: 'POST',
                url: '@Url.Action("BindSubClass")',
                dataType: 'JSON',
                data: { ClassId: Classid },
                success: function (data) {

                    if (data != null)   {
                        var item = '<option value="0">All Division</option>';
                        $.each(data, function (i, d) {
                            item += '<option value="' + d.Value + '">' + d.Text + '</option>';
                        });
                        $("#DivisionId").append(item);
                    }
                    else {
                        var item = '<option value="0">All Division</option>';
                        $("#DivisionId").append(item);
                    }
                   
                }
            });
        });
    });
     
</script>
@Html.Partial("_PermissionHiddenFlds")
<div class="container-fluid-full">
    <div class="row-fluid">
              @Html.Partial("_SMSList")
		<div class="row-fluid">
            <div id="content" class="span10">
        	<div class="row-fluid">
                    <ul class="breadcrumb">
                       <li><i class="icon-home"></i>@Html.ActionLink("Home", "Login", "Login")<i class="icon-angle-right"></i>
                      @Html.ActionLink("Sms Management", "Sms", "Sms", "")<i class="icon-angle-right"></i></li>
                        <li class="active">Sms Management</li>
                    </ul>
                   <div class="row-fluid sortable">
              <div class="box span12">
					<div class="box-header" data-original-title>
						<h2><i class="fa fa-edit"></i><span class="break"></span>Form Elements</h2>
						<div class="box-icon">
						
							<a href="#" class="btn-minimize"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
						
						</div>
					</div>
                               		<div class="box-content">
						<form id="frm" class="form-horizontal">
                              
						
                                  <fieldset>
                                            @using (Html.BeginForm("", "", FormMethod.Post, new { id = "frm",  @class="form-horizontal" }))
                                            {
                                                @Html.ValidationSummary(true)
                                                <div id="lblmsg" class="control-group">
                                                </div>
                                       
                                                <div class="studclass " >
                                                    <div class="control-group">
                                                        @Html.LabelFor(model => model.Classid, new { @class = "control-label" })
                                                         <div class="controls"> 
                                                     
                                                        @Html.DropDownListFor(model => model.Classid, new SelectList(Model._Classlist, "Classid", "Classnm", "0"), "All Class")
                                                        @Html.ValidationMessageFor(model => model.Classid)
                                                             </div>
                                                    </div>
                                                </div>
                                                
                                                    <div class="control-group" >
                                                        @Html.LabelFor(model => model.DivisionId, new { @class = "control-label" })
                                                         <div class="controls"> 
                                                     
                                                        @Html.DropDownListFor(model => model.DivisionId, new SelectList(Model._Divisionlist, "DivisionId", "DivisionName", "0"), "All Division")
                                                        @Html.ValidationMessageFor(model => model.DivisionId)
                                                             </div>
                                                    </div>
                                             
                                                <div class="control-group">
                                                    @Html.Label("Message", new {  @class = "control-label" })
                                                     <div class="controls"> 
                                                    @Html.TextAreaFor(m => m.msg, new {  @maxlength = 140, @cols="50", @rows = "4", @style="padding-right:10px;" })
                                                </div>
                                                    </div>
                                             
                                               <div class="form-actions">
                                                    <input type="button" class="btn btn-primary" id="insert" value="Send" />                                                    
                                                </div>
                                            }
                                       </fieldset>
                                </form>
					
					</div>
				</div><!--/span-->
			
			</div><!--/row-->

                  <div class="row-fluid sortable">
              <div class="box span12">
                  	<div class="box-header" data-original-title>
						<h2><i class="fa fa-edit"></i><span class="break"></span>Form Elements</h2>
						<div class="box-icon">
						
							<a href="#" class="btn-minimize"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
						
						</div>
					</div> 
                  <div class="box-content">
                                               <div id="header" class="table-responsive">
                                        </div>
                                        <div id="result" class="table-responsive">
                                        </div>
                                                </div>
                                             
                                                

                                         </div>
        </div>
                </div>
                </div>

		</div>
        </div>
    </div>
